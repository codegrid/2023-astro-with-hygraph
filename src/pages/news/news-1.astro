---
import BaseLayout from "../../layouts/base-layout.astro";
import Header from "../../components/header.astro";
import NewsDetail from "../../components/news-detail.astro";

const res = await fetch(
  "https://api-ap-northeast-1.hygraph.com/v2/clf9ej9ti0tev01upfsb73kfm/master",
  {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${
        import.meta.env.HYGRAPH_QUERY_PAT
      }`,
    },
    body: JSON.stringify({
      query: `
        query {
          news (stage: PUBLISHED, where: {slug: "news-1"}){
            slug
            title
            body
            publishedAt
            author {
              name
            }
          }
        }
      `,
    }),
  }
);

if (!res.ok)
  throw new Error(`Fetch failed: ${await res.text()}`);

const {
  data: { news },
} = await res.json();
---

<BaseLayout title={`${news.title} | Sample news site`}>
  <Header title="Sample news site" />
  <NewsDetail news={news} />
</BaseLayout>
